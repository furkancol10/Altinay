@using Altinay
@using Altinay.Meeting
@using Altinay.Meeting.CreateUpdateDtos
@using Altinay.Meeting.IAppServices
@using Altinay.Meeting.MeetingRoomDtos
@using Blazorise
@using Localization
@using Microsoft.Extensions.Localization
@using Volo.Abp.AspNetCore.Components.Web
@using Volo.Abp.Validation
@inject IRoomAppService RoomAppService
@inject IStringLocalizer<AltinayResource> L
@* @inherits AltinayComponentBase *@
@inherits AbpCrudPageBase<IRoomAppService, RoomDto, Guid, RoomInputListDto, CreateUpdateRoomDto>

<Modal @ref="CreateRoomModalRef" Visible="@Visible" VisibleChanged="@VisibleChanged">
    <ModalContent IsCentered="True">
        <ModalHeader>
            <ModalTitle>@L["NewRoom"]</ModalTitle>
        </ModalHeader>
        <ModalBody>
            <Validations @ref="@CreateValidations" Model="@NewEntity">
                <Field>
                    <FieldLabel RequiredIndicator>@L["RoomName"]</FieldLabel>
                    <TextEdit @bind-Text="@NewEntity.Name" />
                </Field>
                <Field>
                    <FieldLabel RequiredIndicator>@L["RoomDescription"]</FieldLabel>
                    <TextEdit @bind-Text="@NewEntity.Description" />
                </Field>
                <Field>
                    <FieldLabel RequiredIndicator>@L["RoomCapacity"]</FieldLabel>
                    <NumericEdit TValue="int" @bind-Value="@NewEntity.Capacity" />
                </Field>
            </Validations>
        </ModalBody>
        <ModalFooter>
            <Button Color="Color.Secondary"
                    Clicked="CloseCreateModalAsync">
                @L["Cancel"]
            </Button>
            <Button Color="Color.Primary"
                    Type="ButtonType.Submit"
                    Clicked="CreateAsync"
                    PreventDefaultOnSubmit="true">
                @L["Save"]
            </Button>
        </ModalFooter>
    </ModalContent>
</Modal>


@code {
    [Parameter] public bool Visible { get; set; }
    [Parameter] public EventCallback<bool> VisibleChanged { get; set; }
    [Parameter] public EventCallback OnCreated { get; set; }
    [Parameter] public Guid FloorId { get; set; }

    private CreateUpdateRoomDto NewEntity = new();
    private Modal CreateRoomModalRef;
    private Validations CreateValidations;

    public void Reset()
    {
        NewEntity = new CreateUpdateRoomDto
            {
                FloorID = FloorId
            };
        CreateValidations?.ClearAll();

    }
    private async Task CreateAsync()
    {
        if (await CreateValidations.ValidateAll())
        {
            await RoomAppService.CreateAsync(NewEntity);
            await VisibleChanged.InvokeAsync(false);
            await OnCreated.InvokeAsync();
        }
    }
    private async Task CloseCreateModalAsync()
    {
        await VisibleChanged.InvokeAsync(false);
    }
}
